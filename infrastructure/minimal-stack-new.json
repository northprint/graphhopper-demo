
> @graphhopper-demo/infrastructure@1.0.0 cdk
> cdk synth MinimalAppRunnerStack --no-notices

Description: GraphHopper Demo - Minimal App Runner Services
Resources:
  ApiAccessRoleC8407F5F:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: build.apprunner.amazonaws.com
        Version: "2012-10-17"
      Tags:
        - Key: Environment
          Value: Production
        - Key: ManagedBy
          Value: CDK
        - Key: Project
          Value: GraphHopper-Demo-Minimal
    Metadata:
      aws:cdk:path: MinimalAppRunnerStack/ApiAccessRole/Resource
  ApiAccessRoleDefaultPolicyE206B3AF:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - ecr:BatchCheckLayerAvailability
              - ecr:BatchGetImage
              - ecr:GetAuthorizationToken
              - ecr:GetDownloadUrlForLayer
            Effect: Allow
            Resource: "*"
          - Action:
              - ecr:BatchCheckLayerAvailability
              - ecr:BatchGetImage
              - ecr:GetDownloadUrlForLayer
            Effect: Allow
            Resource: arn:aws:ecr:ap-northeast-1:087850074138:repository/graphhopper-api-simple
        Version: "2012-10-17"
      PolicyName: ApiAccessRoleDefaultPolicyE206B3AF
      Roles:
        - Ref: ApiAccessRoleC8407F5F
    Metadata:
      aws:cdk:path: MinimalAppRunnerStack/ApiAccessRole/DefaultPolicy/Resource
  FrontendAccessRole8EC9718F:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: build.apprunner.amazonaws.com
        Version: "2012-10-17"
      Tags:
        - Key: Environment
          Value: Production
        - Key: ManagedBy
          Value: CDK
        - Key: Project
          Value: GraphHopper-Demo-Minimal
    Metadata:
      aws:cdk:path: MinimalAppRunnerStack/FrontendAccessRole/Resource
  FrontendAccessRoleDefaultPolicy2C7DB7F2:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - ecr:BatchCheckLayerAvailability
              - ecr:BatchGetImage
              - ecr:GetAuthorizationToken
              - ecr:GetDownloadUrlForLayer
            Effect: Allow
            Resource: "*"
          - Action:
              - ecr:BatchCheckLayerAvailability
              - ecr:BatchGetImage
              - ecr:GetDownloadUrlForLayer
            Effect: Allow
            Resource: arn:aws:ecr:ap-northeast-1:087850074138:repository/graphhopper-frontend-simple
        Version: "2012-10-17"
      PolicyName: FrontendAccessRoleDefaultPolicy2C7DB7F2
      Roles:
        - Ref: FrontendAccessRole8EC9718F
    Metadata:
      aws:cdk:path: MinimalAppRunnerStack/FrontendAccessRole/DefaultPolicy/Resource
  GraphHopperAPI:
    Type: AWS::AppRunner::Service
    Properties:
      ServiceName: graphhopper-api-minimal
      SourceConfiguration:
        AuthenticationConfiguration:
          AccessRoleArn:
            Fn::GetAtt:
              - ApiAccessRoleC8407F5F
              - Arn
        ImageRepository:
          ImageConfiguration:
            Port: "8989"
          ImageIdentifier:
            Fn::Join:
              - ""
              - - 087850074138.dkr.ecr.ap-northeast-1.
                - Ref: AWS::URLSuffix
                - /graphhopper-api-simple:latest
          ImageRepositoryType: ECR
      Tags:
        - Key: Environment
          Value: Production
        - Key: ManagedBy
          Value: CDK
        - Key: Project
          Value: GraphHopper-Demo-Minimal
    Metadata:
      aws:cdk:path: MinimalAppRunnerStack/GraphHopperAPI
  FrontendSSR:
    Type: AWS::AppRunner::Service
    Properties:
      ServiceName: graphhopper-frontend-minimal
      SourceConfiguration:
        AuthenticationConfiguration:
          AccessRoleArn:
            Fn::GetAtt:
              - FrontendAccessRole8EC9718F
              - Arn
        ImageRepository:
          ImageConfiguration:
            Port: "3000"
            RuntimeEnvironmentVariables:
              - Name: PUBLIC_GRAPHHOPPER_URL
                Value:
                  Fn::Join:
                    - ""
                    - - https://
                      - Fn::GetAtt:
                          - GraphHopperAPI
                          - ServiceUrl
          ImageIdentifier:
            Fn::Join:
              - ""
              - - 087850074138.dkr.ecr.ap-northeast-1.
                - Ref: AWS::URLSuffix
                - /graphhopper-frontend-simple:latest
          ImageRepositoryType: ECR
      Tags:
        - Key: Environment
          Value: Production
        - Key: ManagedBy
          Value: CDK
        - Key: Project
          Value: GraphHopper-Demo-Minimal
    Metadata:
      aws:cdk:path: MinimalAppRunnerStack/FrontendSSR
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Analytics: v2:deflate64:H4sIAAAAAAAA/yWLSwqDMBBAz+I+TiV00XU9QEs8QEnjCOMnCTOJIpK7l+rqvbd4GnRzh6aym9Sun+qZvnB0ybpJ2U0+BzoGgzEIpcD70woqsgscJsyo2sGffIeZ3P7Py4qyMXL2HhnawXfIKzksyqCEzO4cXznFnIryoUcY5bZqDQ9oqlGIas4+0YJgLv4AMR5RBKUAAAA=
    Metadata:
      aws:cdk:path: MinimalAppRunnerStack/CDKMetadata/Default
Outputs:
  ApiUrl:
    Description: GraphHopper API URL
    Value:
      Fn::Join:
        - ""
        - - https://
          - Fn::GetAtt:
              - GraphHopperAPI
              - ServiceUrl
  FrontendUrl:
    Description: Frontend URL
    Value:
      Fn::Join:
        - ""
        - - https://
          - Fn::GetAtt:
              - FrontendSSR
              - ServiceUrl
Parameters:
  BootstrapVersion:
    Type: AWS::SSM::Parameter::Value<String>
    Default: /cdk-bootstrap/hnb659fds/version
    Description: Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]

